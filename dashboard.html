<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ProGen AI - Dashboard</title>
  <style>
    :root { --primary: #4a90e2; --success: #10b981; --danger: #ef4444; }
    body { font-family: 'Segoe UI', sans-serif; background: #f8f9ff; margin: 0; color: #333; }
    .navbar { background: #fff; padding: 1.2rem 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .logo { font-weight: bold; font-size: 1.8rem; color: var(--primary); cursor: pointer; }
    .nav-links { display: flex; gap: 20px; align-items: center; }
    .nav-links a { text-decoration: none; color: #555; font-weight: 500; padding: 10px 16px; border-radius: 12px; transition: all 0.3s; }
    .nav-links a:hover { background: #f0f8ff; color: var(--primary); }

    .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
    .card { background: #fff; border-radius: 20px; padding: 3rem; box-shadow: 0 15px 40px rgba(0,0,0,0.1); text-align: center; }

    /* PREMIUM BOX — ALWAYS VISIBLE */
    #premiumTemplateBox {
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      color: white; padding: 2.5rem; border-radius: 24px; margin: 0 0 2.5rem 0;
      box-shadow: 0 25px 60px rgba(139,92,246,0.6); animation: float 6s ease-in-out infinite;
      position: relative; overflow: hidden;
    }
    #premiumTemplateBox::before {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,0.07) 35px, rgba(255,255,255,0.07) 70px);
      animation: shine 14s linear infinite;
    }
    .premium-badge { 
      display: inline-block; background: rgba(255,255,255,0.25); padding: 0.6rem 1.6rem; 
      border-radius: 50px; font-weight: bold; font-size: 1rem; margin-bottom: 1rem; backdrop-filter: blur(10px);
    }
    .premium-title { font-size: 2.3rem; margin: 0.5rem 0; font-weight: bold; }
    .premium-code { 
      background: rgba(255,255,255,0.2); padding: 14px 34px; border-radius: 50px; 
      font-family: 'Courier New', monospace; font-size: 2rem; letter-spacing: 5px; margin: 1.2rem 0;
      backdrop-filter: blur(10px);
    }
    .premium-details {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.2rem; margin-top: 1.5rem;
      font-size: 1.05rem;
    }
    .detail-item {
      background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 16px; backdrop-filter: blur(8px);
    }
    .color-preview { display: flex; gap: 12px; margin-top: 8px; }
    .color-box { width: 44px; height: 44px; border-radius: 14px; border: 3px solid rgba(255,255,255,0.4); }

    .universal-templates {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; padding: 2rem; border-radius: 20px; margin: 2rem 0;
      box-shadow: 0 15px 40px rgba(102,126,234,0.4);
    }
    .universal-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;
    }
    .template-option {
      background: rgba(255,255,255,0.15); border-radius: 16px; padding: 1.5rem; cursor: pointer;
      transition: all 0.3s; backdrop-filter: blur(10px); border: 2px solid transparent;
    }
    .template-option:hover { transform: translateY(-6px); background: rgba(255,255,255,0.25); }
    .template-option.selected { border: 3px solid #10b981; background: rgba(16,185,129,0.2); transform: scale(1.05); }

    .locked-product, .info-note { margin: 2rem 0; border-radius: 16px; padding: 2rem; }
    .locked-product { background: #e6f3ff; border: 3px solid var(--primary); font-size: 1.4rem; font-weight: bold; }
    .info-note { background: #f8f9fa; border-left: 5px solid var(--primary); }

    .btn-primary { background: var(--primary); color: white; padding: 1.4rem 2.5rem; border: none; border-radius: 16px; font-size: 1.3rem; width: 100%; cursor: pointer; font-weight: bold; margin: 1rem 0; }
    .btn-success { background: var(--success); color: white; padding: 1.2rem 2rem; border: none; border-radius: 12px; font-size: 1.1rem; cursor: pointer; font-weight: bold; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
    .result-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 12px 30px rgba(0,0,0,0.15); }
    .image-container { height: 520px; background: #f0f7ff; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
    .final-img { display: none; width: 100%; height: 100%; object-fit: cover; }
    .loader-wrapper { position: absolute; z-index: 10; text-align: center; color: var(--primary); }
    .spinner { width: 80px; height: 80px; border: 9px solid #f0f0f0; border-top: 9px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem; }
    .timer-text { font-family: 'Courier New', monospace; font-size: 2rem; font-weight: bold; color: var(--primary); }
    .regenerate-box { margin: 3rem 0 1rem; padding: 2.5rem; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px; box-shadow: 0 15px 40px rgba(102,126,234,0.4); display: none; text-align: center; }

    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes shine { 0% { transform: translateX(-100%) translateY(-100%) rotate(30deg); } 100% { transform: translateX(100%) translateY(100%) rotate(30deg); } }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo" onclick="location.href='dashboard.html'">ProGen AI</div>
    <div class="nav-links">
      <a href="dashboard.html">Dashboard</a>
      <a href="credit.html">Buy Credits (<span id="creditDisplay">20</span>)</a>
      <a href="client-homepage.html">Home</a>
      <a href="index.html">Logout</a>
    </div>
  </nav>

  <div class="container">
    <div class="card">

      <!-- ALWAYS VISIBLE PREMIUM PREVIEW -->
      <div id="premiumTemplateBox">
        <div class="premium-badge" id="premiumBadge">PREMIUM TEMPLATE</div>
        <h2 class="premium-title" id="premiumTitle">Luxury Gold 2025</h2>
        <div class="premium-code" id="premiumCode">LUX-2025-GOLD</div>
        <p id="premiumSource" style="opacity:0.9;font-size:1.1rem;margin:1rem 0;">Enter code to unlock this exclusive style</p>
        <div class="premium-details">
          <div class="detail-item"><strong>Aesthetic</strong><br>Luxury & Elegant</div>
          <div class="detail-item"><strong>Style</strong><br>Studio Product Shot</div>
          <div class="detail-item"><strong>Colors</strong>
            <div class="color-preview">
              <div class="color-box" style="background:#ffd700;"></div>
              <div class="color-box" style="background:#1a1a1a;"></div>
            </div>
          </div>
          <div class="detail-item"><strong>Industry</strong><br>Jewelry • Watches • Premium</div>
        </div>
      </div>

      <h2 style="font-size:2.4rem; margin-bottom:1rem;">
        Stunning Images for <span style="color:var(--primary);" id="productNameDisplay">Your Product</span>
      </h2>

      <div class="universal-templates">
        <h3 style="margin:0 0 1rem;">Choose Your Style (Free Templates)</h3>
        <div class="universal-grid" id="universalTemplates"></div>
      </div>

      <div style="margin:2.5rem 0;">
        <h3>Have a Premium Code?</h3>
        <input type="text" id="templateCodeInput" placeholder="e.g. LUX-2025-GOLD" style="padding:14px; width:340px; border:1px solid #ccc; border-radius:12px; font-size:1.2rem;" />
        <button onclick="applyTemplateCode()" style="margin-left:10px; padding:12px 24px; background:#8b5cf6; color:white; border:none; border-radius:12px; cursor:pointer; font-weight:bold;">Activate Premium</button>
        <p id="templateStatus" style="margin-top:1rem; font-weight:bold;"></p>
      </div>

      <div class="locked-product">
        Product: <span id="lockedProductName">Loading...</span>
      </div>

      <div class="info-note">
        Lightning-fast • 1024×1024 HD • 2 credits per generation • Powered by Pollinations.ai
      </div>

      <button class="btn-primary" onclick="generateNow()">
        Generate 2 Images Now (-2 Credits)
      </button>

      <div id="results" class="grid-2" style="display:none;"></div>

      <div id="regenerateBox" class="regenerate-box">
        <h3>Want more variations?</h3>
        <button class="btn-success" onclick="generateNow()">Generate 2 More (-2 Credits)</button>
      </div>
    </div>
  </div>

  <script>
    let productName = "Premium Product";
    let currentUser = { email: "" };
    let activeTemplate = null;

    const UNIVERSAL_TEMPLATES = [
      { id: "clean-white", name: "Clean White Studio", desc: "Pure white, soft light", promptAdd: ", clean white seamless background, soft studio lighting, premium product photography" },
      { id: "dark-moody", name: "Dark & Moody", desc: "Cinematic black backdrop", promptAdd: ", dark black background, moody cinematic lighting, high contrast, luxury" },
      { id: "natural-light", name: "Natural Window Light", desc: "Soft daylight feel", promptAdd: ", soft natural window light, light gray backdrop, lifestyle product shot" },
      { id: "gold-luxury", name: "Gold Luxury", desc: "Golden hour vibes", promptAdd: ", golden hour lighting, subtle gold reflections, ultra premium" },
      { id: "minimal-gray", name: "Minimal Gray", desc: "Scandinavian simplicity", promptAdd: ", light gray seamless background, minimal composition, soft shadows" }
    ];

    document.addEventListener('DOMContentLoaded', () => {
      try {
        currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      } catch(e) {}
      if (!currentUser.email) {
        alert("Please login first");
        location.href = 'index.html';
        return;
      }

      productName = localStorage.getItem('userProduct') || "Your Product";
      document.getElementById('productNameDisplay').textContent = productName;
      document.getElementById('lockedProductName').textContent = productName;
      updateCredits();

      // Check for saved premium code
      const saved = localStorage.getItem(`userPremiumCode_${currentUser.email}`);
      if (saved) {
        try {
          const t = JSON.parse(saved);
          activatePremium(t);
        } catch(e) {}
      }

      const savedChoice = localStorage.getItem(`userTemplateChoice_${currentUser.email}`) || "clean-white";
      renderUniversalTemplates(savedChoice);
      if (!activeTemplate) activeTemplate = UNIVERSAL_TEMPLATES.find(t => t.id === savedChoice);
    });

    function activatePremium(template) {
      document.getElementById('premiumBadge').textContent = "PREMIUM ACTIVE";
      document.getElementById('premiumBadge').style.background = "rgba(16,185,129,0.5)";
      document.getElementById('premiumTitle').textContent = template.name || "Premium Active";
      document.getElementById('premiumCode').textContent = template.code || "CUSTOM";
      document.getElementById('premiumSource').textContent = "Premium style activated";
      document.getElementById('premiumSource').style.color = "#10b981";
      activeTemplate = template;
    }

    window.applyTemplateCode = function() {
      const code = document.getElementById('templateCodeInput').value.trim().toUpperCase();
      if (!code) return;

      const allTemplates = JSON.parse(localStorage.getItem("progenTemplatesV2") || '{"_history":[]}')._history || [];
      const found = allTemplates.find(t => t.code === code);

      if (found) {
        activatePremium(found);
        localStorage.setItem(`userPremiumCode_${currentUser.email}`, JSON.stringify(found));
        document.getElementById('templateStatus').innerHTML = '<span style="color:#10b981;">Premium template activated!</span>';
      } else {
        document.getElementById('templateStatus').innerHTML = '<span style="color:#ef4444;">Invalid or expired code</span>';
      }
    };

    function renderUniversalTemplates(selectedId) {
      const container = document.getElementById('universalTemplates');
      container.innerHTML = UNIVERSAL_TEMPLATES.map(t => `
        <div class="template-option ${t.id === selectedId ? 'selected' : ''}" onclick="selectUniversalTemplate('${t.id}')">
          <h4>${t.name}</h4>
          <p>${t.desc}</p>
        </div>
      `).join('');
    }

    window.selectUniversalTemplate = function(id) {
      localStorage.setItem(`userTemplateChoice_${currentUser.email}`, id);
      renderUniversalTemplates(id);
      activeTemplate = UNIVERSAL_TEMPLATES.find(t => t.id === id);
    };

    function getFullPrompt() {
      let prompt = `${productName}, photorealistic, ultra sharp, 8k, commercial product photography, sharp focus`;
      if (activeTemplate?.promptAdd) {
        prompt += activeTemplate.promptAdd;
      } else {
        prompt += ", clean white seamless background, soft studio lighting";
      }
      prompt += `, seed:${Date.now() + Math.floor(Math.random()*100000)}`;
      return prompt;
    }

    function updateCredits() {
      const credits = parseInt(localStorage.getItem('userCredits') || '20');
      document.getElementById('creditDisplay').textContent = credits;
    }

    function deductCredits() {
      let credits = parseInt(localStorage.getItem('userCredits') || '20');
      if (credits < 2) {
        alert("Not enough credits!");
        setTimeout(() => location.href = 'credit.html', 1000);
        return false;
      }
      credits -= 2;
      localStorage.setItem('userCredits', credits);
      updateCredits();
      return true;
    }

    function saveToHistory(url, prompt) {
      const records = JSON.parse(localStorage.getItem('userRecords') || '{}');
      if (!records[currentUser.email]) records[currentUser.email] = [];
      records[currentUser.email].unshift({
        imageUrl: url,
        prompt: prompt,
        title: productName + (activeTemplate ? ` [${activeTemplate.name || activeTemplate.code}]` : ""),
        date: new Date().toISOString()
      });
      if (records[currentUser.email].length > 50) records[currentUser.email].pop();
      localStorage.setItem('userRecords', JSON.stringify(records));
    }

    window.generateNow = function() {
      if (!deductCredits()) return;

      const results = document.getElementById('results');
      results.style.display = 'grid';
      results.innerHTML = '';
      document.getElementById('regenerateBox').style.display = 'block';

      const prompt = getFullPrompt();

      for (let i = 0; i < 2; i++) {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.innerHTML = `
          <div class="image-container">
            <div class="loader-wrapper">
              <div class="spinner"></div>
              <div class="timer-text">00:15</div>
              <p>Generating your image...</p>
            </div>
            <img class="final-img" alt="Generated ${i+1}" />
          </div>
          <div style="padding:1.5rem;">
            <button class="btn-success" onclick="downloadImage(this.closest('.result-card').querySelector('img').src)">
              Download Image ${i+1}
            </button>
          </div>
        `;
        results.appendChild(card);

        const img = card.querySelector('.final-img');
        const timerText = card.querySelector('.timer-text');
        let seconds = 15;
        const timer = setInterval(() => {
          seconds--;
          timerText.textContent = `00:${seconds.toString().padStart(2, '0')}`;
          if (seconds <= 0) clearInterval(timer);
        }, 1000);

        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=1024&height=1024&seed=${Date.now()+i*10000}&nologo=true&enhance=true`;

        img.onload = () => {
          img.style.display = 'block';
          card.querySelector('.loader-wrapper').style.display = 'none';
          clearInterval(timer);
          saveToHistory(img.src, prompt);
        };
        img.onerror = () => {
          card.querySelector('.loader-wrapper').innerHTML = '<p style="color:red;">Failed. Try again!</p>';
          clearInterval(timer);
        };
        img.src = url;
      }
    };

    window.downloadImage = function(src) {
      const a = document.createElement('a');
      a.href = src;
      a.download = `${productName.replace(/ /g, '_')}_${Date.now()}.jpg`;
      a.click();
    };
  </script>
</body>
</html>


