<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Account - ProGen AI</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Create Your Account</h1>
      <p class="subtitle">
        Fill in your details – a unique <strong>Industry Code</strong> will be e-mailed to you.
      </p>

      <form id="registerForm">
        <!-- Company & Email -->
        <div class="input-group">
          <label for="company">Company Name *</label>
          <input type="text" id="company" placeholder="e.g., Acme Corp" required />
        </div>

        <div class="input-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" placeholder="you@company.com" required />
        </div>

        <!-- Industry -->
        <div class="input-group">
          <label for="industry">Industry *</label>
          <select id="industry" onchange="toggleCustomIndustry()">
            <option value="Retail">Retail</option>
            <option value="Food and Beverage">Food and Beverage</option>
            <option value="E-commerce">E-commerce</option>
            <option value="Beauty">Beauty</option>
            <option value="Others">Others (Please specify)</option>
          </select>
          <input type="text" id="customIndustry" placeholder="Enter your industry"
                 class="mt-4" style="display:none;" />
        </div>

        <!-- Product Name (locked in dashboard) -->
        <div class="input-group">
          <label for="productName">Product Name *</label>
          <input type="text" id="productName" placeholder="e.g., Glow Serum, Eco Bottle" required />
        </div>

        <div class="input-group">
          <label for="requirements">Company Requirements</label>
          <textarea id="requirements" rows="3" placeholder="Branding, tone, target audience…"></textarea>
        </div>

        <!-- Value Prompts (optional – max 5) -->
        <div class="input-group">
          <label>Value Prompts (Optional – max 5)</label>
          <p class="text-sm" style="color:var(--gray); margin-bottom: .5rem;">
            e.g. "cartoon", "3D render", "minimalist"
          </p>
          <div id="valuePrompts" class="mb-3"></div>
          <button type="button" class="btn btn-sm btn-secondary" id="addValueBtn">+ Add Value</button>
        </div>

        <!-- Default Image Specifications -->
        <h2>Default Image Specifications</h2>
        <div class="grid-2">
          <div class="input-group">
            <label for="format">Format</label>
            <select id="format">
              <option value="PNG">PNG</option>
              <option value="JPEG">JPEG</option>
              <option value="WEBP">WEBP</option>
            </select>
          </div>
          <div class="input-group">
            <label for="resolution">Resolution</label>
            <select id="resolution">
              <option value="1024x1024">1024 × 1024</option>
              <option value="768x1152">768 × 1152 (Portrait)</option>
              <option value="1152x768">1152 × 768 (Landscape)</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-4">
          Create Account & Send Code
        </button>
      </form>

      <p class="text-center mt-4"><a href="index.html">Back to Login</a></p>
    </div>
  </div>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    console.log("=== PROGEN AI REGISTER PAGE LOADED ===");
    let valuePromptCount = 0;

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('addValueBtn').addEventListener('click', addValuePrompt);
      updateAddButtonState();
    });

    function addValuePrompt() {
      if (valuePromptCount >= 5) {
        alert("Maximum 5 value prompts allowed.");
        return;
      }
      valuePromptCount++;

      const container = document.getElementById("valuePrompts");
      const wrapper = document.createElement("div");
      wrapper.className = "input-group";
      wrapper.style.marginBottom = "0.75rem";

      wrapper.innerHTML = `
        <div class="d-flex gap-1 align-center">
          <input type="text" placeholder="e.g. cartoon, 3D render..." class="flex-grow" style="margin:0;" />
          <button type="button" class="btn btn-danger btn-sm" onclick="removeValuePrompt(this)">Remove</button>
        </div>
      `;

      container.appendChild(wrapper);
      wrapper.querySelector('input').focus();
      updateAddButtonState();
    }

    function removeValuePrompt(btn) {
      btn.closest(".input-group").remove();
      valuePromptCount--;
      updateAddButtonState();
    }

    function updateAddButtonState() {
      const btn = document.getElementById('addValueBtn');
      if (valuePromptCount >= 5) {
        btn.disabled = true;
        btn.textContent = "Max 5 reached";
        btn.classList.remove('btn-secondary');
        btn.classList.add('btn');
        btn.style.background = '#ccc';
      } else {
        btn.disabled = false;
        btn.textContent = "+ Add Value";
        btn.classList.add('btn-secondary');
        btn.style.background = '';
      }
    }

    function toggleCustomIndustry() {
      const select = document.getElementById("industry");
      const custom = document.getElementById("customIndustry");
      if (select.value === "Others") {
        custom.style.display = "block";
        custom.required = true;
      } else {
        custom.style.display = "none";
        custom.required = false;
      }
    }

    // Form Submit
    document.getElementById("registerForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const company   = document.getElementById("company").value.trim();
      const email     = document.getElementById("email").value.trim();
      const industrySelect = document.getElementById("industry").value;
      const customIndustry = document.getElementById("customIndustry").value.trim();
      const product   = document.getElementById("productName").value.trim();
      const reqs      = document.getElementById("requirements").value.trim();

      if (!company || !email || !product) {
        alert("Please fill all required fields (Company, Email, Product).");
        return;
      }

      const industry = industrySelect === "Others" ? customIndustry : industrySelect;
      if (industrySelect === "Others" && !customIndustry) {
        alert("Please enter your custom industry.");
        return;
      }

      const valuePrompts = Array.from(document.querySelectorAll("#valuePrompts input"))
                               .map(i => i.value.trim())
                               .filter(v => v);

      const format     = document.getElementById("format").value;
      const resolution = document.getElementById("resolution").value;

      // Generate Industry Code
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = 'IND';
      for (let i = 0; i < 9; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }

      // Store product name (locked in dashboard) + pending code
      localStorage.setItem("userProduct", product);
      localStorage.setItem("pendingCode", code);

      const userData = { company, email, industry, product, requirements: reqs,
                         valuePrompts, format, resolution, createdAt: new Date().toISOString() };
      localStorage.setItem("tempUser", JSON.stringify(userData));

      const templateParams = { company, email, product, industry, code };
      emailjs.init("04haQDj1VizCiKBn4");

      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "Sending Code...";

      try {
        await emailjs.send("service_1vi3zyz", "template_y5dzqi9", templateParams);
        alert(`Account created!\nYour Code: ${code}\nCheck your email and log in!`);
        window.location.href = "index.html";
      } catch (err) {
        console.error("EmailJS error:", err);
        alert(`Account created, but email failed.\nYour Code: ${code}\nSAVE IT NOW!`);
        window.location.href = "index.html";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Create Account & Send Code";
      }
    });
  </script>
</body>
</html>
